---
platform: linux

image_resource:
  type: docker-image
  source: {repository: ubuntu}

#inputs:
#- name: nginx
 # path: ./taskFolder/nginx.sh

run:
  path: bash
  args:
  - -ec
  - |
    #!/bin/bash
    
    apt-get upgrade -y
    sudo apt-get update -y
    sudo apt-get install wget -y
    sudo apt-get install git -y
    sudo apt-get install virtualbox-ose-dkms
    sudo apt-get install linux-headers-generic
    sudo dpkg-reconfigure virtualbox-dkms
    sudo dpkg-reconfigure virtualbox
    sudo dpkg-reconfigure virtualbox-dkms
    sudo modprobe vboxdrv
    sudo modprobe vboxnetflt
    sudo apt-get install -y virtualbox virtualbox-qt virtualbox-dkms 
    sudo apt-get install -y build-essential zlibc zlib1g-dev ruby ruby-dev openssl libxslt1-dev libxml2-dev libssl-dev libreadline7 libreadline-dev libyaml-dev libsqlite3-dev sqlite3
    
    wget https://github.com/cloudfoundry/bosh-cli/releases/download/v5.5.1/bosh-cli-5.5.1-linux-amd64
    chmod +x ./bosh-cli-5.5.1-linux-amd64
    mv ./bosh-cli-5.5.1-linux-amd64 /usr/local/bin/bosh
    
    mkdir -p ~/bosh-env/virtualbox
    cd ~/bosh-env/virtualbox
    git clone https://github.com/cloudfoundry/bosh-deployment.git
    ./bosh-deployment/virtualbox/create-env.sh
    source .envrc
    bosh -e vbox env
    echo "Done........."